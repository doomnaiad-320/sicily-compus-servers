<view class="order-detail">
  <!-- åŠ è½½ä¸­ -->
  <view wx:if="{{loading}}" class="loading-container">
    <t-loading theme="circular" size="48rpx" text="åŠ è½½ä¸­..." />
  </view>

  <!-- è®¢å•å†…å®¹ -->
  <view wx:elif="{{order}}" class="order-content">
    <!-- é¡¶éƒ¨çŠ¶æ€å¡ç‰‡ -->
    <view class="status-card" style="background: {{statusBgColor}};">
      <view class="status-info">
        <text class="status-text">{{statusText}}</text>
        <text class="order-no">#{{order.orderNo || order.id}}</text>
      </view>
      <view class="amount-info">
        <text class="amount-label">æœåŠ¡è´¹ç”¨</text>
        <text class="amount-value">Â¥{{order.amount}}</text>
      </view>
    </view>

    <!-- æœåŠ¡ä¿¡æ¯å¡ç‰‡ -->
    <view class="info-card">
      <view class="card-title">æœåŠ¡ä¿¡æ¯</view>
      <view class="info-row">
        <text class="info-label">æœåŠ¡ç±»å‹</text>
        <text class="info-value">{{order.type}}</text>
      </view>
      <view class="info-row" wx:if="{{order.title}}">
        <text class="info-label">è®¢å•æ ‡é¢˜</text>
        <text class="info-value">{{order.title}}</text>
      </view>
      <view class="info-row desc-row">
        <text class="info-label">éœ€æ±‚æè¿°</text>
        <text class="info-value desc-text">{{order.description}}</text>
      </view>
    </view>

    <!-- æ—¶é—´åœ°ç‚¹å¡ç‰‡ -->
    <view class="info-card">
      <view class="card-title">æ—¶é—´åœ°ç‚¹</view>
      <view class="info-row">
        <text class="info-icon">ğŸ“</text>
        <text class="info-value flex-1">{{order.address}}</text>
      </view>
      <view class="info-row" wx:if="{{order.expectedTime}}">
        <text class="info-icon">â°</text>
        <text class="info-value flex-1">{{order.expectedTime}}</text>
      </view>
    </view>

    <!-- è”ç³»ä¿¡æ¯å¡ç‰‡ï¼ˆéå…¬å¼€è®¢å•æ‰æ˜¾ç¤ºï¼‰ -->
    <view class="info-card" wx:if="{{order.contactName || order.contactPhone}}">
      <view class="card-title">è”ç³»æ–¹å¼</view>
      <view class="info-row" wx:if="{{order.contactName}}">
        <text class="info-icon">ğŸ‘¤</text>
        <text class="info-value flex-1">{{order.contactName}}</text>
      </view>
      <view class="info-row" wx:if="{{order.contactPhone}}">
        <text class="info-icon">ğŸ“</text>
        <text class="info-value flex-1">{{order.contactPhone}}</text>
        <t-button size="extra-small" theme="primary" variant="outline" data-phone="{{order.contactPhone}}" bindtap="callPhone">æ‹¨æ‰“</t-button>
      </view>
    </view>

    <!-- å›¾ç‰‡å±•ç¤º -->
    <view class="info-card" wx:if="{{order.images && order.images.length > 0}}">
      <view class="card-title">ç›¸å…³å›¾ç‰‡</view>
      <view class="image-list">
        <image
          wx:for="{{order.images}}"
          wx:key="index"
          src="{{item}}"
          mode="aspectFill"
          class="order-image"
          data-url="{{item}}"
          bindtap="previewImage"
        />
      </view>
    </view>

    <!-- äº¤ä»˜å†…å®¹å½•å…¥ï¼ˆä»…æ¥å•å…¼èŒè€…ä¸”æœåŠ¡ä¸­ï¼‰ -->
    <view class="info-card" wx:if="{{canDeliver}}">
      <view class="card-title">äº¤ä»˜å†…å®¹</view>
      <view class="input-group">
        <view class="input-row">
          <text class="input-label">å¤‡æ³¨</text>
          <text class="input-tip">å¯¹ç”¨æˆ·å¯è§ï¼Œæè¿°æœåŠ¡æƒ…å†µ</text>
        </view>
        <textarea
          class="delivery-textarea"
          value="{{deliveryNoteInput}}"
          placeholder="å¡«å†™æœåŠ¡å¤‡æ³¨"
          placeholder-class="placeholder"
          maxlength="200"
          auto-height
          bindinput="onNoteInput"
        />
      </view>
      <view class="input-group">
        <view class="input-row">
          <text class="input-label">äº¤ä»˜å›¾ç‰‡</text>
          <text class="input-tip">æœ€å¤š6å¼ </text>
        </view>
        <view class="upload-list">
          <view
            wx:for="{{deliveryImages}}"
            wx:key="index"
            class="upload-thumb"
            data-index="{{index}}"
          >
            <image
              src="{{item}}"
              mode="aspectFill"
              data-url="{{item}}"
              bindtap="previewDeliveryImage"
            />
            <view class="upload-remove" data-index="{{index}}" catchtap="removeDeliveryImage">Ã—</view>
          </view>
          <view
            wx:if="{{deliveryImages.length < 6}}"
            class="upload-add"
            bindtap="chooseDeliveryImages"
          >
            <text>ï¼‹</text>
          </view>
        </view>
      </view>
      <t-button
        block
        theme="primary"
        size="large"
        loading="{{submitting || uploading}}"
        bindtap="submitDelivery"
      >
        äº¤ä»˜ä»»åŠ¡
      </t-button>
    </view>

    <!-- äº¤ä»˜å†…å®¹å±•ç¤º -->
    <view
      class="info-card"
      wx:if="{{order.deliveryNote || (order.deliveryImages && order.deliveryImages.length > 0)}}"
    >
      <view class="card-title">äº¤ä»˜å†…å®¹</view>
      <view class="info-row desc-row" wx:if="{{order.deliveryNote}}">
        <text class="info-label">å¤‡æ³¨</text>
        <text class="info-value desc-text">{{order.deliveryNote}}</text>
      </view>
      <view class="image-list" wx:if="{{order.deliveryImages && order.deliveryImages.length > 0}}">
        <image
          wx:for="{{order.deliveryImages}}"
          wx:key="index"
          src="{{item}}"
          mode="aspectFill"
          class="order-image"
          data-url="{{item}}"
          bindtap="previewDeliveryImage"
        />
      </view>
      <view class="deliver-meta" wx:if="{{order.deliveredAt}}">
        <text>äº¤ä»˜æ—¶é—´ï¼š{{order.deliveredAt}}</text>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view wx:else class="empty-container">
    <t-empty icon="info-circle-filled" description="è®¢å•ä¸å­˜åœ¨" />
  </view>

  <!-- åº•éƒ¨æ“ä½œæ  -->
  <view class="action-bar" wx:if="{{actions.length > 0}}">
    <t-button
      wx:for="{{actions}}"
      wx:key="key"
      theme="{{item.theme}}"
      size="large"
      class="action-btn"
      data-key="{{item.key}}"
      loading="{{submitting}}"
      bindtap="onActionTap"
    >
      {{item.text}}
    </t-button>
  </view>
</view>
